---
layout: post
title: spring-cloud 灰度发布
date: 2020-1-20 14:32:00
categories:  spring-cloud 灰度
---

# 1. 背景
马上要过年了，运营有一个需求是在大年初一那天完成计划并打卡，就像用户发送1000的金币，并且推送一条通知。
由于这个需求只能在过年那天生效，所以测试的时候只能将时间改在今天(这里其实需要**配置中心**)，并且还有个蛋疼的事情是到线上只有**测试用户的id**可以使用这个功能(这里需要按userId来**灰度发布**)。   

所以这个小功能本来很简单的，我要做的是将   
1. 生效日期设置为今天：2020-1-20，再加一个if(userId==测试的userId) .
2. 然后测试组的开始测试。
3. 测试通过后，再把日期改为过年那天:2020-1-25，把if去掉。重新上线。


其实这个功能需要一个**配置中心**和**灰度发布功能**，项目刚切到spring-cloud 全家桶，这些东西都没有，下面我自己撸一个。




