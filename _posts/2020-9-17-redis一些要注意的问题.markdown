---
layout: post
title: redis一些要注意的问题
date: 2020-9-17 14:32:00
categories:  java maven
---

# 1.业务上的问题
## 1. big key
## 2. hot key

https://www.cnblogs.com/leeego-123/p/11588429.html

## 3. 雪崩
key的超时时间 random一下，防止同时过期。
redis高可用架构，能用物理机不用虚拟机。
做好降级的准备。

## 4. 穿透
就是指用户不断发起请求的数据，在缓存和DB中都没有，比如DB中的用户ID是自增的，但是用户请求传了-1，或者是一个特别大的数字，这个时候用户很有可能就是一个攻击者，这样的功击会导致DB的压力过大，严重的话就是把DB搞挂了。因为每次都绕开了缓存直接查询DB
### 解决办法:

1.如果拿到一个null值的话，把null值也缓存以下，设置一个比较短的过期时间。
2.高级用户布隆过滤器（Bloom Filter),这个也能很好地防止缓存穿透。原理就是利用高效的数据结构和算法快速判断出你这个Key是否在DB中存在，不存在你return就好了，存在你就去查了DB刷新KV再return。

## 缓存击穿
跟缓存雪崩类似，但是又有点不一样。雪崩是因为大面积缓存失效，请求全打到DB；而缓存击穿是指一个key是热点，不停地扛住大并发请求，全都集中访问此key,而当此key过期瞬间，持续的大并发就击穿缓存，全都打在DB上。就又引发雪崩的问题。

### 解决办法
1.加入互斥锁，只能有一个线程能沟访问db重建缓存。
2.让热点缓存永远不过期，后台起线程去更新还曾。


## 5. 分布式锁
redission 
看门狗，续期。

redlock 也有很多坑。